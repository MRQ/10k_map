<!doctype html>
<html lang="de">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/cccac-bw.css" id="theme">

	<!-- For syntax highlighting -->
	<link rel="stylesheet" href="lib/css/zenburn.css">

	<!--[if lt IE 9]>
	<script src="lib/js/html5shiv.js"></script>
	<![endif]-->
	<title>Vortrag 10k-Karte</title>
	<style>
	section.largetransparent {
		background-color: transparent !important;
		top: -378px !important;
		border: 0px !important;
		padding: 0px;
	}
	.reveal section img.plain {
		margin: 0px;
		border: 0px;
		box-shadow: none;
		background-color: transparent;
	}
	</style>
</head>

<body>

<div class="reveal">

<!-- Any section element inside of this container is displayed as a slide -->
<div class="slides">

	<section>
		<h1>OpenStreetMap<br/> in 10k</h1>
		<p>
			<pre>git clone <a href="https://github.com/MRQ/10k_map">https://github.com/MRQ/10k_map</a></pre>
		</p>
		<p>Inhalt:</p>
		<ol>
			<li>Wettbewerb <em>10K Apart</em></li>
			<li>Overpass API</li>
			<li>Eigener Code</li>
			<li>Ausblick / Unzulänglichkeiten</li>
		</ol>
	</section>

	<section>
		<section>
			<p><a href="https://a-k-apart.com/">https://a-k-apart.com/</a></p>
			<iframe src="saved_pages/a-k-apart.html" width="1000" height="530">
			</iframe>
		</section>
		<section>
			<h2>10K Apart, die Regeln</h2>
			<ul>
				<li>Nutzbare Seite, nachdem die ersten 10 KiB geladen geladen sind</li>
				<li>Seite sollte <em>progressive enhancement</em> nutzen</li>
				<li>HTTP-Header zählen nicht, HTTP-Kompression erlaubt (→ gzip)</li>
				<li>Javascript erlaubt</li>
				<li>Jury-Entscheid</li>
			</ul>
			<aside class="notes">
				<div>progressive enhancement: Basis-Seite, die weitere Komponenten nachläd.</div>
				<div>Text-Browser-Test angekündigt</div>
			</aside>
		</section>
			<section class="largetransparent">
			<iframe src="../index.html" width="1200" height="750">
			</iframe>
		</section>
	</section>
	<section>
		<section>
			<h2>Datenquelle</h2>
			<p>
				<div><a href="http://download.geofabrik.de/europe/germany/nordrhein-westfalen/koeln-regbez.html">http://download.geofabrik.de/europe/germany/nordrhein-westfalen/koeln-regbez.html</a></div>
				<div>koeln-regbez-latest.osm.bz2, 259 MB</div>
			</p>
			Nachteile:
			<ul>
				<li>Reicht nicht über die Grenzen nach NL / BE.</li>
				<li>1173 MiB dekomprimiertes XML, Parsing dauert lang</li>
			</ul>
		</section>
		<section>
			<h2><img style="display: block; float: left; height: 70px" class="plain" src="saved_pages/overpass-api.png" alt="Overpass API" /><a style="display: block; height: 70px" href="http://www.overpass-api.de/">http://www.overpass-api.de/</a></h2>
			<p>Testbar auf <a href="http://overpass-turbo.eu/">http://overpass-turbo.eu/</a></p>
			<img src="saved_pages/overpass-turbo.png" />
		</section>
		<section>
		<h2>Overpass query language</h2>
		<pre><code class="cpp" style="max-height: none">[timeout:120];
// ↑ Um den Server bei einem Schreibfehler nicht zu überlasten.
(
  (
    // way: Datentyp in der Ausgabe.
    // (): Auswahl
    // around: (radius/m), (lat/°), (lon/°)
    // []: Filter
    way(around:6000,50.785,6.106)["highway"~"motorway|motorway_link| ↴
    ↳ trunk|trunk_link|primary|primary_link|secondary|secondary_link"];
    way(around:4000,50.785,6.106)["railway"];
    way(around:4000,50.785,6.106)["landuse"];
    way(around:2400,50.785,6.106)["highway"];
  );
  &gt;;
  // ↑ Alle Nodes zu diesen Ways nachladen.
  node(around:4800,50.785,6.106)["place"];
);
out body; // alle benötigten Daten ausgeben</code></pre>
			<aside class="notes">
				<div>Overpass QL kann noch deutlich mehr.</div>
				<div>Beispiel für ein längeres Query: Alle Kinos in Bonn, Abstand zu Bushalt &lt; 100m</div>
				<div>große Auswahlen sind langsam, stark einschränkende Filter machen es nicht besser.</div>
			</aside>
		</section>
	</section>
	<section> <!-- eigener Code -->
		<section>
			<h2>libxml++ ☺</h2>
			<p>SAX-Parser verfügbar:</p>
			<pre><code class="cpp">class OsmParser : public xmlpp::SaxParser
{
// …
protected:
	virtual void on_start_element(
		const Glib::ustring& name,
		const AttributeList& properties
	);
	virtual void on_end_element(const Glib::ustring& name);
// …
};</code></pre>
			<aside class="notes">
				<div>Ich war auf einem XML-Parser den es sich auch für zukünftige Projekte lohnt anzugucken.</div>
				<div>Vollständige XML-Unterstützung hier nicht notwendig, aber ich bevorzuge Korrektheit.</div>
			</aside>
		</section>
		<section>
			<h2>libxml++ ☹</h2>
			<pre>$ time bzcat nordrhein-westfalen.osm.bz2 | ↴
    ↳ operf --callgraph ./build/10k_map_generator 50.7795 6.0998
operf: Profiler started

…
WARNING: Lost samples detected! See /…/oprofile_data/samples/operf.log for details.

Profiling done.

real	2m41.436s
user	6m21.772s
sys	0m7.244s</pre>
		<pre>opreport --accumulated --symbols</pre>
		<table style="font-size: 0.6em; line-height: 1em; margin-left: 3em">
		<tr><td>13,8%</td><td>libxml2.so.2.9.1</td></tr>		
		<tr><td>&#8199;6,6%</td><td>_gconv_get_builtin_trans</td></tr>
		<tr><td>&#8199;1,4%</td><td>_gconv_lookup_cache</td></tr>
		<tr><td>&#8199;1,4%</td><td>_gconv_transform_internal_ascii</td></tr>
		<tr><td>&#8199;1,1%</td><td>_gconv_transform_utf8_internal</td></tr>		
		<tr><td>&#8199;1,1%</td><td>iconv_open</td></tr>
		</table>
		→ <code>Glib::ustring</code>
		<aside class="notes">
			<div>Also mindestens 12% Overhead durch Unicode-Transformationen</div>
		</aside>
		</section>
	</section>
</div>

</div> <!-- end class=reveal -->

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

	// Full list of configuration options available here:
	// https://github.com/hakimel/reveal.js#configuration
	Reveal.initialize({
		controls: true,
		progress: true,
		history: true,
		center: true,
		rollingLinks: false,

		theme: Reveal.getQueryHash().theme || 'cccac-bw', // available themes are in /css/theme
		transition: Reveal.getQueryHash().transition || 'none', // default/cube/page/concave/zoom/linear/fade/none

		// Optional libraries used to extend on reveal.js
		dependencies: [
			{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
			{ src: 'plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
			{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
			{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
			{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
			{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
			// { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
		],
		width: (1380 - 130*2),
		height: 710,
		margin: 0.0,
		maxScale: 1.0
	});

</script>

</body>
</html>
